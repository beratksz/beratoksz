@{
    ViewData["Title"] = "Email Doğrulama";
}

<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="text-center p-5 shadow-lg rounded-3 bg-white">
        <div id="confirmation-status" class="mb-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Yükleniyor...</span>
            </div>
            <p class="mt-3">Email adresiniz doğrulanıyor...</p>
        </div>
        <div id="result-message" style="display:none;">
            <div id="lottie-animation" style="height:200px;"></div>
            <h3 id="message-text" class="mt-4"></h3>
            <a href="/VAccount/Login" class="btn btn-success mt-3">Giriş Yap</a>
        </div>
    </div>
</div>

<!-- Lottie Animasyonu CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let userId = "@ViewBag.UserId";
        let token = "@ViewBag.Token";

                 fetch(`/api/Account/confirm-email?userId=${userId}&token=${token}`)
                    .then(response => response.json())
                .then(data => {
                document.getElementById("confirmation-status").style.display = "none";
                document.getElementById("result-message").style.display = "block";

                let animationPath = data.success ?
                    'https://lottie.host/37b32a9a-0bb7-462d-a6e8-870983158079/l1O6RdHz8G.json' :
                    'https://lottie.host/08cb55f3-17f1-41c0-936a-e51f9722365a/mK3vaPTLBO.json';

                lottie.loadAnimation({
                    container: document.getElementById('lottie-animation'),
                    renderer: 'svg',
                    loop: false,
                    autoplay: true,
                    path: animationPath
                });

                document.getElementById("message-text").innerText = data.message || (data.success ? "Email doğrulandı!" : "Doğrulama başarısız!");
            })
            .catch(() => {
                document.getElementById("confirmation-status").style.display = "none";
                document.getElementById("result-message").style.display = "block";
                document.getElementById("message-text").innerText = "Bir hata oluştu. Lütfen tekrar deneyin.";
            });
    });
</script>
