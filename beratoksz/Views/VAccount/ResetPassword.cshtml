@{
    ViewData["Title"] = "Yeni Şifre Belirle";
}

<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="card shadow-lg text-center p-4">
        <div id="resetAnimation" style="height: 180px;"></div>
        <h3 class="mt-3 fw-bold">🔐 Yeni Şifreni Belirle</h3>

        <form id="resetForm">
            <input type="hidden" id="UserId" value="@ViewBag.UserId" />
            <input type="hidden" id="Token" value="@ViewBag.Token" />

            <div class="mb-3">
                <input type="password" id="NewPassword" class="form-control" placeholder="Yeni Şifre" required minlength="6" />
            </div>

            <div class="mb-3">
                <input type="password" id="ConfirmNewPassword" class="form-control" placeholder="Şifreyi Onayla" required minlength="6" />
            </div>

            <button type="submit" class="btn btn-success w-100">Kaydet</button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.7.6/lottie.min.js"></script>

<script>
    lottie.loadAnimation({
        container: document.getElementById('resetAnimation'),
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: 'https://lottie.host/5b116c72-bb87-4fd7-9a7f-14f14a2e939a/T7EmQkvjdm.json'
    });

    document.getElementById("resetForm").addEventListener("submit", function(event) {
        event.preventDefault();

        let newPassword = document.getElementById("NewPassword").value;
        let confirmPassword = document.getElementById("ConfirmNewPassword").value;

        if (newPassword !== confirmPassword) {
            Swal.fire('Hata!', 'Şifreler eşleşmiyor!', 'error');
            return;
        }

        fetch("/api/Account/reset-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                UserId: document.getElementById("UserId").value,
                Token: document.getElementById("Token").value,
                NewPassword: newPassword,
                ConfirmPassword: confirmPassword
            })
        })
        .then(res => res.json())
        .then(data => {
            Swal.fire('Başarılı!', data.message, 'success');
            setTimeout(() => window.location.href = "/VAccount/Login", 3000);
        })
        .catch(err => {
            Swal.fire('Hata!', err.message, 'error');
        });
    });
</script>

<style>
    body {
        background: linear-gradient(135deg, #c8e6c9, #a5d6a7);
    }

    .card {
        width: 100%;
        max-width: 450px;
        border-radius: 15px;
    }
</style>
