@using Microsoft.AspNetCore.Identity
@model IEnumerable<IdentityRole>

@{
    ViewData["Title"] = "Rol Yönetimi";
}

<script src="/js/roles.js"></script>
<script src="/js/permissions.js"></script>

<div class="container-fluid mt-4">
    <h1 class="mb-4">Rol Yönetimi</h1>

    <div id="alert-container"></div>

    <!-- Arama Kutusu -->
    <input type="text" id="roleFilterInput" class="form-control mb-3" placeholder="ID veya Rol Adı Ara..." onkeyup="filterRoles()">

    <button class="btn btn-success mb-3" onclick="showAddRoleModal()">Yeni Rol Ekle</button>

    <div class="table-responsive">
        <table class="table table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Rol Adı</th>
                    <th>İşlemler</th>
                </tr>
            </thead>
            <tbody id="roleTableBody"></tbody>
        </table>
    </div>
</div>


<!-- ✅ Yeni Rol Ekle Modal -->
<div id="roleModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Rol Ekle / Düzenle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="roleId">
                <label for="roleName">Rol Adı:</label>
                <input type="text" id="roleName" class="form-control" required />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                <button type="button" class="btn btn-primary" onclick="saveRole()">Kaydet</button>
            </div>
        </div>
    </div>
</div>

<!-- ✅ Yetkilendirme Yönetimi -->
<div class="container-fluid mt-4">
    <h1 class="mb-4">Rol Yetkilendirme Yönetimi</h1>

    <!-- Arama Kutusu -->
    <input type="text" id="filterInput" class="form-control mb-3" placeholder="Rol veya Sayfa Ara..." onkeyup="filterTable()">

    <button class="btn btn-primary mb-3" onclick="showAddPermissionModal()">Yeni Yetki Ekle</button>

    <div class="table-responsive">
        <table class="table table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Rol</th>
                    <th>Sayfa</th>
                    <th>Erişim</th>
                    <th>İşlemler</th>
                </tr>
            </thead>
            <tbody id="rolePermissionTable"></tbody>
        </table>
    </div>
</div>


<!-- ✅ Yeni Yetki Ekle Modal -->
<div id="addPermissionModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Yeni Yetki Ekle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <label>Rol Seç:</label>
                <select id="roleNameSelect" class="form-control"></select>

                <label>Sayfa Seç:</label>
                <select id="pagePathSelect" class="form-control"></select>

                <label>Erişim:</label>
                <select id="canAccessSelect" class="form-control">
                    <option value="true">Evet</option>
                    <option value="false">Hayır</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                <button type="button" class="btn btn-primary" onclick="addPermission()">Kaydet</button>
            </div>
        </div>
    </div>
</div>

                <script>
                        function filterTable() {
        let input = document.getElementById("filterInput").value.toLowerCase();
        let rows = document.querySelectorAll("#rolePermissionTable tr");

        rows.forEach(row => {
            let role = row.cells[0].innerText.toLowerCase();
            let page = row.cells[1].innerText.toLowerCase();

            if (role.includes(input) || page.includes(input)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    }



        function filterRoles() {
        let input = document.getElementById("roleFilterInput").value.toLowerCase();
        let rows = document.querySelectorAll("#roleTableBody tr");

        rows.forEach(row => {
            let roleId = row.cells[0].innerText.toLowerCase();
            let roleName = row.cells[1].innerText.toLowerCase();

            if (roleId.includes(input) || roleName.includes(input)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    }

                </script>